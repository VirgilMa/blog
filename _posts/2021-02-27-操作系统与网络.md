---
layout: post
title: "操作系统与网络面试题整理 (整理中)"
---

## 操作系统

### 进程间有哪些通信方式？

一共有七种方式

- 管道/匿名管道：是半双工的；只能用于有亲缘关系的进程；每次写入的内容都会添加到管道缓冲区的末尾，并每次从头部读出。
  - 单独构成一种独立的文件系统：管道对于管道两端的进程而言，就是一个文件，但它不是普通的文件，它不属于某种文件系统，而是自立门户，单独构成一种文件系统，并且只存在与内存中。
- FIFO，有名管道：以文件形式存在于文件系统中，使得不具有亲缘关系的进程也能使用。严格遵循first in first out；FIFO的名字存在于文件系统中，而内容仅在内存中；
- 信号（Signal）：用于进程间相互通信或者操作的一种机制，可以无关进程状态进行发送。
  - 常用信号：SIGHUP, SIGINT, SIGQUIT, SIGBUS, SIGSEGV, SIGKILL, SIGCLD
  - 信号生命周期和处理流程：
    1. 信号被某个进程产生，并设置传递对象（根据pid），然后传递给操作系统；
    2. 根据接收进程的设置而选择性地发送给接收者；
    3. 目的进程接收到此信号后，将根据当前进程对此信号设置的预处理方式，暂时终止当前代码的执行，保护上下文（主要包括临时寄存器数据，当前程序位置以及当前CPU的状态）、转而执行中断服务程序，执行完成后在回复到中断的位置。当然，对于抢占式内核，在中断返回时还将引发新的调度。
- 消息队列（message queue）
  - 存放在内核中的消息链表，每个消息队列由消息队列标识符表示；
  - 与管道不同的是，消息队列存放在内核中，只有在内核重启(即，操作系统重启)或者显示地删除一个消息队列时，该消息队列才会被真正的删除。
  - 另外与管道不同的是，消息队列在某个进程往一个队列写入消息之前，并不需要另外某个进程在该队列上等待消息的到达。
    - 消息队列是消息的链表,具有特定的格式,存放在内存中并由消息队列标识符标识.
    - 消息队列允许一个或多个进程向它写入与读取消息.
    - 管道和消息队列的通信数据都是先进先出的原则。
    - 消息队列可以实现消息的随机查询,消息不一定要以先进先出的次序读取,也可以按消息的类型读取.比FIFO更有优势。
    - 消息队列克服了信号承载信息量少，管道只能承载无格式字 节流以及缓冲区大小受限等缺。
    - 目前主要有两种类型的消息队列：POSIX消息队列以及System V消息队列，System V消息队列目前被大量使用。系统V消息队列是随内核持续的，只有在内核重起或者人工删除时，该消息队列才会被删除。
- 共享内存：是最快的IPC形式，但是需要某种同步机制来达到进程间的同步
- 信号量：创建、等待、挂载
- 套接字（socket）：TCP/IP的基本操作单元，
  - 套接字有两个域：
    - AF_INET指的是Internet网络
    - AF_UNIX指的是UNIX文件系统，他的地址就是文件名。

### 进程通信中的管道实现原理是什么？

在Linux中，管道的实现并没有使用专门的数据结构，而是借助了文件系统的file结构和VFS的索引节点inode。
通过将两个file结构指向同一个临时的 VFS 索引节点，而这个 VFS 索引节点又指向一个物理页面而实现的。
如下图有两个 file 数据结构，但它们定义文件操作例程地址是不同的，其中一个是向管道中写入数据的例程地址，
而另一个是从管道中读出数据的例程地址。
这样，用户程序的系统调用仍然是通常的文件操作，而内核却利用这种抽象机制实现了管道这一特殊操作。

### 线程有多少种状态，状态之间如何转换

### 进程有多少种状态？



### 读写文件时的buffer与cache：

cache：高速缓存，用于CPU与内存之间的缓冲；

buffer：I/O缓存，用于内存与磁盘的缓冲，主要用于缓冲写。

buffer cache与page cache：页缓存page cache面向的是虚拟内存，块I/O缓存Buffer cache是面向块设备。

#### page cache

页缓存是面向文件，面向内存的。通俗来说，它位于内存和文件之间缓冲区，文件IO操作实际上只和page cache交互，不直接和内存交互。page cache可以用在所有以文件为单元的场景下，比如网络文件系统等等。page cache通过一系列的数据结构，比如inode, address_space, struct page，实现将一个文件映射到页的级别.

#### 读写文件基本流程：

**读文件**：

1、进程调用库函数向内核发起读文件请求；

2、内核通过检查进程的文件描述符定位到虚拟文件系统的已打开文件列表表项；

3、调用该文件可用的系统调用函数read()

3、read()函数通过文件表项链接到目录项模块，根据传入的文件路径，在目录项模块中检索，找到该文件的inode；

4、在inode中，通过文件内容偏移量计算出要读取的页；

5、通过inode找到文件对应的address_space；

6、在address_space中访问该文件的页缓存树，查找对应的页缓存结点：

（1）如果页缓存命中，那么直接返回文件内容；

（2）如果页缓存缺失，那么产生一个页缺失异常，创建一个页缓存页，同时通过inode找到文件该页的磁盘地址，读取相应的页填充该缓存页；重新进行第6步查找页缓存；

7、文件内容读取成功。

**写文件**

前5步和读文件一致，在address_space中查询对应页的页缓存是否存在：

6、如果页缓存命中，直接把文件内容修改更新在页缓存的页中。写文件就结束了。这时候文件修改位于页缓存，并没有写回到磁盘文件中去。

7、如果页缓存缺失，那么产生一个页缺失异常，创建一个页缓存页，同时通过inode找到文件该页的磁盘地址，读取相应的页填充该缓存页。此时缓存页命中，进行第6步。

8、一个页缓存中的页如果被修改，那么会被标记成脏页。脏页需要写回到磁盘中的文件块。有两种方式可以把脏页写回磁盘：

（1）手动调用sync()或者fsync()系统调用把脏页写回

（2）pdflush进程会定时把脏页写回到磁盘

同时注意，脏页不能被置换出内存，如果脏页正在被写回，那么会被设置写回标记，这时候该页就被上锁，其他写请求被阻塞直到锁释放。





### 简述 socket 中 select 与 epoll 的使用场景以及区别，epoll 中水平触发以及边缘触发有什么不同？

### Linux 下如何排查 CPU 以及 内存占用过多？

### Linux 下如何查看 CPU 荷载，正在运行的进程，某个端口对应的进程？

### 如何调试服务器内存占用过高的问题？

### Linux 如何查看实时的滚动日志？





## 网络

### HTTP 与 HTTPS 有哪些区别？

https是HTTP下加入SSL层，https协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。

https工作原理：

1. 客户端发起https请求；

2. 服务端传送证书；

3. 客户端解析证书；

   这部分工作是有客户端的TLS来完成的，首先会验证公钥是否有效，比如颁发机构，过期时间等等，如果发现异常，则会弹出一个警告框，提示证书存在问题。

   如果证书没有问题，那么就生成一个随机值，然后用证书对该随机值进行加密。

4. 传送加密信息（对称加密的私钥）；

5. 服务端解密信息，并根据该私钥将请求的数据进行对称加密，传输加密后的信息。

6. 客户端解密信息。

### 简述 TCP 三次握手以及四次挥手的流程。为什么需要三次握手以及四次挥手？

#### 三次握手

1. 第一次握手：client发送syn给server；

2. 第二次握手：server发送ack+syn给client；
3. 第三次握手：client发送ack给server；

目的是client与server确认双方都具有*发送*与*接受*数据的能力。

需要第三次握手的原因：第一、二次握手后，服务端并不知道客户端的接收能力以及自己的发送能力是否正常。

#### 四次挥手

1. 第一二次挥手：server发送fin给client，client返回ack；
2. 第三四次挥手：client发送fin给server，server返回ack。

第一二次的目的是server告知client自己已经发送完毕，有结束的意愿；

第三四次的目的是client告诉server自己的数据已经发送完毕，可以结束了。

### 从输入 URL 到展现页面的全过程

### TCP 中常见的拥塞控制算法有哪些？

### DNS 查询服务器的基本流程是什么？DNS 劫持是什么？

### Cookie 和 Session 的关系和区别是什么？

### 简述 HTTP 1.0，1.1，2.0 的主要区别

### TCP 怎么保证可靠传输？

### 什么是 TCP 粘包和拆包？

### 什么是跨域，什么情况下会发生跨域请求？

**跨域请求**就是指：当前发起请求的域与该请求指向的资源所在的域不一样。这里的域指的是这样的一个概念：我们认为若协议 + 域名 + 端口号均相同，那么就是同域。

### TCP 中 SYN 攻击是什么？如何防止？

### 简述 WebSocket 是如何进行传输的

### 从系统层面上，UDP如何保证尽量可靠？

### TCP 四次挥手的时候 CLOSE_WAIT 的话怎么处理？



## 系统设计

### 什么是幂等操作，如何实现

在编程中一个幂等操作的特点是其任意多次执行所产生的影响均与一次执行的影响相同。

实现的常见思路：

1. MVCC多版本并发控制：在数据更新时更新版本号，使得版本号不一致的操作无法操作成功；
2. 去重表：
3. Token机制：

